// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  transactions Transaction[]
  invoices     Invoice[]
  recurringTransactions RecurringTransaction[]
  bankAccounts BankAccount[]

  @@map("users")
}

model Transaction {
  id          String            @id @default(uuid())
  type        TransactionType
  description String
  category    String?
  amount      Decimal           @db.Decimal(12, 2)
  date        DateTime          @default(now())
  recurring   Boolean           @default(false)
  recurringType RecurringType?
  recurringEndDate DateTime?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  // Relations
  userId      String
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  bankAccountId String?
  bankAccount BankAccount?      @relation(fields: [bankAccountId], references: [id], onDelete: SetNull)

  @@map("transactions")
}

model Invoice {
  id          String        @id @default(uuid())
  invoiceNumber String      @unique
  clientName  String
  clientAddress String?
  items       Json          // JSON field for invoice items
  subtotal    Decimal       @db.Decimal(12, 2)
  totalAmount Decimal       @db.Decimal(12, 2)
  status      InvoiceStatus @default(PENDING)
  issueDate   DateTime      @default(now())
  paidDate    DateTime?
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  bankAccountId String?
  bankAccount BankAccount?  @relation(fields: [bankAccountId], references: [id], onDelete: SetNull)

  @@map("invoices")
}

model RecurringTransaction {
  id          String            @id @default(uuid())
  type        TransactionType
  description String
  category    String?
  amount      Decimal           @db.Decimal(12, 2)
  frequency   RecurringType
  nextDate    DateTime
  endDate     DateTime?
  isActive    Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  // Relations
  userId      String
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("recurring_transactions")
}

model BankAccount {
  id            String   @id @default(uuid())
  bankName      String
  accountNumber String
  accountHolder String
  accountType   BankAccountType @default(SAVINGS)
  ifscCode      String?
  branchName    String?
  isActive      Boolean  @default(true)
  balance       Decimal  @default(0) @db.Decimal(12, 2)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions  Transaction[]
  invoices      Invoice[]

  @@unique([userId, accountNumber])
  @@map("bank_accounts")
}

model Settings {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("settings")
}

// Enums for PostgreSQL
enum UserRole {
  USER
  ADMIN
  STAFF
}

enum TransactionType {
  CREDIT
  DEBIT
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

enum RecurringType {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum BankAccountType {
  SAVINGS
  CURRENT
  CREDIT_CARD
  LOAN
  INVESTMENT
}
